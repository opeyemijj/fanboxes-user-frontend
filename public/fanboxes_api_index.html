<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Fanboxes API Documentation</title>
    <style>
      :root {
        --bg: #0f1220;
        --panel: #171a2a;
        --panel-2: #1e2236;
        --text: #e7e9f3;
        --muted: #aab0c2;
        --accent: #6ee7b7;
        --accent-2: #60a5fa;
        --border: #2a2f45;
        --danger: #fca5a5;
        --ok: #86efac;
        --warn: #fde68a;
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial,
          "Apple Color Emoji", "Segoe UI Emoji";
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: var(--sans);
        background: linear-gradient(
          180deg,
          #0b0e1a 0%,
          var(--bg) 30%,
          #0b0e1a 100%
        );
        color: var(--text);
        line-height: 1.6;
      }
      .layout {
        display: grid;
        grid-template-columns: 280px 1fr;
        min-height: 100vh;
      }
      .sidebar {
        position: sticky;
        top: 0;
        align-self: start;
        height: 100vh;
        overflow: auto;
        padding: 28px 20px;
        background: var(--panel);
        border-right: 1px solid var(--border);
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 24px;
      }
      .logo {
        width: 32px;
        height: 32px;
        border-radius: 10px;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        box-shadow: 0 6px 20px rgba(96, 165, 250, 0.3);
      }
      .brand h1 {
        font-size: 18px;
        margin: 0;
        letter-spacing: 0.3px;
      }
      .nav h4 {
        margin: 20px 0 8px;
        color: var(--muted);
        font-weight: 600;
        text-transform: uppercase;
        font-size: 11px;
        letter-spacing: 0.12em;
      }
      .nav a {
        display: block;
        padding: 8px 10px;
        border-radius: 10px;
        color: var(--text);
        text-decoration: none;
        font-size: 14px;
        border: 1px solid transparent;
      }
      .nav a:hover {
        background: var(--panel-2);
        border-color: var(--border);
      }

      .content {
        padding: 40px 56px;
      }
      .hero {
        background: radial-gradient(
            1200px 500px at 10% -20%,
            rgba(96, 165, 250, 0.12),
            transparent
          ),
          radial-gradient(
            800px 400px at 90% 0%,
            rgba(110, 231, 183, 0.1),
            transparent
          );
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 28px;
      }
      .badges {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 14px 0 6px;
      }
      .badge {
        padding: 6px 10px;
        border-radius: 999px;
        background: var(--panel-2);
        border: 1px solid var(--border);
        font-size: 12px;
        color: var(--muted);
      }
      .base-url {
        font-family: var(--mono);
        color: var(--accent);
        font-size: 14px;
        background: #0b0f1f;
        border: 1px dashed #223;
        padding: 8px 10px;
        border-radius: 8px;
        display: inline-block;
        margin-top: 6px;
      }

      h2 {
        margin-top: 42px;
        margin-bottom: 10px;
        font-size: 28px;
      }
      h3 {
        margin-top: 28px;
        margin-bottom: 8px;
        font-size: 20px;
      }
      p {
        color: #d6d9e6;
        margin: 8px 0 14px;
      }

      .callout {
        background: #10142a;
        border: 1px solid var(--border);
        border-left: 4px solid var(--accent-2);
        padding: 12px 14px;
        border-radius: 10px;
        font-size: 14px;
      }

      .grid {
        display: grid;
        gap: 18px;
      }
      .grid-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      @media (max-width: 980px) {
        .layout {
          grid-template-columns: 1fr;
        }
        .sidebar {
          position: relative;
          height: auto;
        }
        .content {
          padding: 26px;
        }
        .grid-2 {
          grid-template-columns: 1fr;
        }
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 14px;
        overflow: hidden;
      }
      th,
      td {
        padding: 12px 14px;
        border-bottom: 1px solid var(--border);
        vertical-align: top;
      }
      thead th {
        background: #14182a;
        color: var(--muted);
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }
      tbody tr:hover {
        background: rgba(255, 255, 255, 0.02);
      }

      code,
      pre {
        font-family: var(--mono);
      }
      pre {
        background: #0c1022;
        border: 1px solid var(--border);
        padding: 14px;
        border-radius: 12px;
        overflow: auto;
      }
      .k {
        color: #93c5fd;
      }
      .s {
        color: #86efac;
      }
      .n {
        color: #fca5a5;
      }
      .p {
        color: #e5e7eb;
      }

      .card {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 16px;
      }

      .flex {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .copy {
        margin-left: auto;
        cursor: pointer;
        border: 1px solid var(--border);
        background: var(--panel-2);
        color: var(--text);
        padding: 6px 10px;
        border-radius: 8px;
        font-size: 12px;
      }
      .copy:hover {
        filter: brightness(1.1);
      }
      .label {
        font-size: 12px;
        color: var(--muted);
      }
      .status {
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        border: 1px solid var(--border);
      }
      .ok {
        background: rgba(34, 197, 94, 0.1);
        color: #86efac;
      }
      .warn {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warn);
      }
      .bad {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
      }
      .endpoint {
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: var(--mono);
      }
      .method {
        font-weight: 700;
        padding: 4px 8px;
        border-radius: 6px;
        border: 1px solid var(--border);
      }
      .GET {
        color: #60a5fa;
        background: rgba(96, 165, 250, 0.12);
      }
      .POST {
        color: #22c55e;
        background: rgba(34, 197, 94, 0.12);
      }
    </style>
  </head>
  <body>
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <h1>Spin Management API</h1>
        </div>
        <nav class="nav">
          <h4>Overview</h4>
          <a href="#intro">Introduction</a>
          <a href="#auth">Authentication</a>
          <a href="#models">Data Models</a>
          <h4>Endpoints</h4>
          <a href="#ep-create">POST /admin/spin</a>
          <a href="#ep-verify">POST /admin/spin-verify</a>
          <a href="#ep-list">GET /admin/spins</a>
          <h4>References</h4>
          <a href="#provably">Provably Fair Algorithm</a>
          <a href="#errors">Error Handling</a>
        </nav>
      </aside>

      <main class="content">
        <section class="hero" id="intro">
          <h1 style="margin: 0 0 6px; font-size: 34px">
            Spin Management API Documentation
          </h1>
          <div class="badges">
            <span class="badge">Date: October 26, 2023</span>
            <span class="badge">Version: 1.0</span>
            <span class="badge">Backend: Node.js</span>
          </div>
          <p>
            The Spin Management API provides endpoints for simulating
            <strong>provably fair</strong> spin operations (e.g., loot box
            systems). Administrators can create spins, verify fairness, and list
            historical spins.
          </p>
          <div class="grid grid-2">
            <div class="card">
              <div class="label">Base URL</div>
              <div class="base-url">
                https://fanboxes-admin-backend.vercel.app/api
              </div>
            </div>
            <div class="card" id="auth">
              <div class="label">Authorization Header</div>
              <pre><code>Authorization: Bearer &lt;your_jwt_token&gt;</code></pre>
            </div>
          </div>
        </section>

        <section id="models">
          <h2>2. Data Models</h2>
          <h3>2.1 Spin Model</h3>
          <div class="card">
            <table>
              <thead>
                <tr>
                  <th>Field</th>
                  <th>Type</th>
                  <th>Description</th>
                  <th>Required</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>_id</td>
                  <td>ObjectId</td>
                  <td>Unique identifier for the spin record.</td>
                  <td>Auto</td>
                </tr>
                <tr>
                  <td>boxId</td>
                  <td>ObjectId</td>
                  <td>Reference to the product/box that was spun.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>boxDetails</td>
                  <td>Mixed</td>
                  <td>Snapshot of product details at the time of the spin.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>vendorId</td>
                  <td>ObjectId</td>
                  <td>Reference to the vendor/influencer.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>vendorDetails</td>
                  <td>Mixed</td>
                  <td>Snapshot of vendor details.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>userId</td>
                  <td>ObjectId</td>
                  <td>Reference to the user who performed the spin.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>userDetails</td>
                  <td>Mixed</td>
                  <td>Snapshot of user details.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>shop</td>
                  <td>ObjectId</td>
                  <td>Reference to the shop.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>shopDetails</td>
                  <td>Mixed</td>
                  <td>Snapshot of shop details.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>oddsMap</td>
                  <td>Mixed</td>
                  <td>Probability ranges for each item in the box.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>clientSeed</td>
                  <td>String</td>
                  <td>Client-provided seed used in randomness generation.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>serverSeed</td>
                  <td>String</td>
                  <td>Server-generated secret seed.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>serverSeedHash</td>
                  <td>String</td>
                  <td>SHA-256 hash of the serverSeed (pre-commitment).</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>nonce</td>
                  <td>Number</td>
                  <td>
                    Incrementing counter ensuring uniqueness of each spin.
                  </td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>winningItem</td>
                  <td>Mixed</td>
                  <td>The item won from the spin.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>normalized</td>
                  <td>String</td>
                  <td>Normalized float (0–1) derived from hash.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>hash</td>
                  <td>String</td>
                  <td>Final SHA-256 hash used to determine the winner.</td>
                  <td>Yes</td>
                </tr>
                <tr>
                  <td>createdAt</td>
                  <td>Date</td>
                  <td>Record creation timestamp.</td>
                  <td>Auto</td>
                </tr>
                <tr>
                  <td>updatedAt</td>
                  <td>Date</td>
                  <td>Record modification timestamp.</td>
                  <td>Auto</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <section id="ep-create">
          <h2>3. API Endpoints</h2>
          <h3>
            <span class="endpoint"
              ><span class="method POST">POST</span> /admin/spin</span
            >
          </h3>
          <p>Creates a new spin event using the provably fair algorithm.</p>
          <div class="grid grid-2">
            <div class="card">
              <div class="label">Request Body</div>
              <button
                class="copy"
                data-copy='{"boxId":"652a1b2c3d4e5f0012345678","clientSeed":"abc123clientseed"}'
              >
                Copy JSON
              </button>
              <pre><code>{
  "boxId": "652a1b2c3d4e5f0012345678",
  "clientSeed": "abc123clientseed"
}</code></pre>
              <div class="label" style="margin-top: 8px">Parameters</div>
              <table style="margin-top: 8px">
                <thead>
                  <tr>
                    <th>Parameter</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Required</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>boxId</td>
                    <td>String</td>
                    <td>ID of the box/product to spin.</td>
                    <td>Yes</td>
                  </tr>
                  <tr>
                    <td>clientSeed</td>
                    <td>String</td>
                    <td>Client-provided seed for randomness.</td>
                    <td>Yes</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="card">
              <div class="label">cURL</div>
              <button
                class="copy"
                data-copy='curl -X POST "https://fanboxes-admin-backend.vercel.app/api/admin/spin" -H "Authorization: Bearer <your_jwt_token>" -H "Content-Type: application/json" -d "{\"boxId\":\"652a1b2c3d4e5f0012345678\",\"clientSeed\":\"abc123clientseed\"}"'
              >
                Copy
              </button>
              <pre><code>curl -X POST \
  "https://fanboxes-admin-backend.vercel.app/api/admin/spin" \
  -H "Authorization: Bearer &lt;your_jwt_token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "boxId":"652a1b2c3d4e5f0012345678",
    "clientSeed":"abc123clientseed"
  }'</code></pre>
              <div class="label" style="margin-top: 8px">Success (200)</div>
              <pre><code>{
  "success": true,
  "data": {
    "_id": "652a...",
    "boxId": "652a1b2c3d4e5f0012345678",
    "clientSeed": "abc123clientseed",
    "serverSeed": "d18a...",
    "serverSeedHash": "a1b2...",
    "nonce": 42,
    "winningItem": { /* ... */ }
  }
}</code></pre>
              <div class="label" style="margin-top: 8px">Errors</div>
              <ul>
                <li>
                  <span class="status bad">401 Unauthorized</span>
                  Invalid/missing JWT
                </li>
                <li>
                  <span class="status warn">404 Not Found</span> Box not found
                  or empty
                </li>
                <li>
                  <span class="status warn">403 Forbidden</span> No winning item
                  computed
                </li>
                <li>
                  <span class="status warn">400 Bad Request</span> Invalid
                  request body
                </li>
              </ul>
            </div>
          </div>
        </section>

        <section id="ep-verify">
          <h3>
            <span class="endpoint"
              ><span class="method POST">POST</span> /admin/spin-verify</span
            >
          </h3>
          <p>
            Verifies the integrity and fairness of a previously created spin by
            recalculating the hash using seeds and nonce.
          </p>
          <div class="grid grid-2">
            <div class="card">
              <div class="label">Request Body</div>
              <button
                class="copy"
                data-copy='{"clientSeed":"abc123clientseed","serverSeed":"d18a5f3c...","nonce":42}'
              >
                Copy JSON
              </button>
              <pre><code>{
  "clientSeed": "abc123clientseed",
  "serverSeed": "d18a5f3c...",
  "nonce": 42
}</code></pre>
              <div class="label" style="margin-top: 8px">Parameters</div>
              <table style="margin-top: 8px">
                <thead>
                  <tr>
                    <th>Parameter</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Required</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>clientSeed</td>
                    <td>String</td>
                    <td>Client seed from the original spin.</td>
                    <td>Yes</td>
                  </tr>
                  <tr>
                    <td>serverSeed</td>
                    <td>String</td>
                    <td>Server seed from the original spin.</td>
                    <td>Yes</td>
                  </tr>
                  <tr>
                    <td>nonce</td>
                    <td>Number</td>
                    <td>Nonce from the original spin.</td>
                    <td>Yes</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="card">
              <div class="label">cURL</div>
              <button
                class="copy"
                data-copy='curl -X POST "https://fanboxes-admin-backend.vercel.app/api/admin/spin-verify" -H "Authorization: Bearer <your_jwt_token>" -H "Content-Type: application/json" -d "{\"clientSeed\":\"abc123clientseed\",\"serverSeed\":\"d18a5f3c...\",\"nonce\":42}"'
              >
                Copy
              </button>
              <pre><code>curl -X POST \
  "https://fanboxes-admin-backend.vercel.app/api/admin/spin-verify" \
  -H "Authorization: Bearer &lt;your_jwt_token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "clientSeed":"abc123clientseed",
    "serverSeed":"d18a5f3c...",
    "nonce":42
  }'</code></pre>
              <div class="label" style="margin-top: 8px">Success (200)</div>
              <pre><code>{
  "success": true,
  "message": "Success spin verification",
  "data": { /* Full Spin object */ }
}</code></pre>
              <div class="label" style="margin-top: 8px">Errors</div>
              <ul>
                <li>
                  <span class="status bad">401 Unauthorized</span> Not an admin
                  or spin not found
                </li>
                <li>
                  <span class="status warn">400 Bad Request</span> Invalid body
                  or server error
                </li>
              </ul>
            </div>
          </div>
        </section>

        <section id="ep-list">
          <h3>
            <span class="endpoint"
              ><span class="method GET">GET</span> /admin/spins</span
            >
          </h3>
          <p>
            Retrieves a paginated list of all spin records. Sorted by
            <code>createdAt</code> (newest first). Requires admin JWT.
          </p>
          <div class="grid grid-2">
            <div class="card">
              <div class="label">Query Parameters</div>
              <table>
                <thead>
                  <tr>
                    <th>Parameter</th>
                    <th>Type</th>
                    <th>Default</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>page</td>
                    <td>Number</td>
                    <td>1</td>
                    <td>Page number</td>
                  </tr>
                  <tr>
                    <td>limit</td>
                    <td>Number</td>
                    <td>10</td>
                    <td>Items per page</td>
                  </tr>
                </tbody>
              </table>
              <div class="label" style="margin-top: 8px">Example</div>
              <pre><code>GET /admin/spins?page=2&amp;limit=15</code></pre>
            </div>
            <div class="card">
              <div class="label">cURL</div>
              <button
                class="copy"
                data-copy='curl -X GET "https://fanboxes-admin-backend.vercel.app/api/admin/spins?page=2&limit=15" -H "Authorization: Bearer <your_jwt_token>"'
              >
                Copy
              </button>
              <pre><code>curl -X GET \
  "https://fanboxes-admin-backend.vercel.app/api/admin/spins?page=2&limit=15" \
  -H "Authorization: Bearer &lt;your_jwt_token&gt;"</code></pre>
              <div class="label" style="margin-top: 8px">Success (200)</div>
              <pre><code>{
  "success": true,
  "data": [
    { /* Spin 1 */ },
    { /* Spin 2 */ }
  ],
  "count": 7
}</code></pre>
              <div class="label" style="margin-top: 8px">Errors</div>
              <ul>
                <li>
                  <span class="status bad">401 Unauthorized</span> User not
                  admin
                </li>
                <li>
                  <span class="status warn">400 Bad Request</span> Invalid query
                  parameters
                </li>
              </ul>
            </div>
          </div>
        </section>

        <section id="provably">
          <h2>4. Provably Fair Algorithm</h2>
          <div class="card">
            <ol>
              <li>
                <strong>Inputs</strong>: <code>serverSeed</code> (secret),
                <code>clientSeed</code> (public),
                <code>nonce</code> (incremental).
              </li>
              <li>
                <strong>Combine</strong>:
                <code>{serverSeed}-{clientSeed}-{nonce}</code>
              </li>
              <li>
                <strong>Hash</strong>: Compute <code>SHA-256</code> of the
                combined string.
              </li>
              <li>
                <strong>Normalize</strong>: Convert first 8 hex chars (32 bits)
                to a decimal and normalize to a float in <code>[0, 1)</code>.
              </li>
              <li>
                <strong>Select Winner</strong>: Compare the normalized value to
                cumulative odds for each item to determine the winning item.
              </li>
              <li>
                <strong>Verify</strong>: Re-run steps 2–4 with the revealed
                values and confirm the hash and selected range match the stored
                record.
              </li>
            </ol>
            <h3>Pseudocode</h3>
            <pre><code>// inputs
const serverSeed = "&lt;revealed&gt;";
const clientSeed = "abc123clientseed";
const nonce = 42;

// 1) combine
const input = `${serverSeed}-${clientSeed}-${nonce}`;

// 2) sha256 + 3) normalize (first 8 hex -> 32-bit -> [0,1))
// implementation language-specific

// 4) map to cumulative odds
// if 0.00-0.50 => Item1, 0.50-0.80 => Item2, 0.80-1.00 => Item3, etc.</code></pre>
          </div>
        </section>

        <section id="errors">
          <h2>5. Error Handling</h2>
          <div class="card">
            <p>All error responses follow a consistent format:</p>
            <pre><code>{
  "success": false,
  "message": "A human-readable description of the error."
}</code></pre>
            <h3>Common HTTP Status Codes</h3>
            <ul>
              <li><span class="status ok">200 OK</span> Request successful</li>
              <li>
                <span class="status warn">400 Bad Request</span> Invalid input
              </li>
              <li>
                <span class="status bad">401 Unauthorized</span> Authentication
                failed
              </li>
              <li>
                <span class="status warn">403 Forbidden</span> Access denied
              </li>
              <li>
                <span class="status warn">404 Not Found</span> Resource not
                found
              </li>
            </ul>
          </div>
        </section>

        <footer
          style="margin: 40px 0 20px; color: var(--muted); font-size: 13px"
        >
          © Spin Management API Docs • Built as a single-page
          <code>index.html</code>
        </footer>
      </main>
    </div>

    <script>
      // Smooth anchor scrolling
      document.querySelectorAll('a[href^="#"]').forEach((a) => {
        a.addEventListener("click", (e) => {
          const id = a.getAttribute("href");
          const el = document.querySelector(id);
          if (el) {
            e.preventDefault();
            el.scrollIntoView({ behavior: "smooth", block: "start" });
          }
        });
      });

      // Copy helpers
      function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
          // simple visual feedback
        });
      }
      document.querySelectorAll(".copy").forEach((btn) => {
        btn.addEventListener("click", () =>
          copyToClipboard(btn.getAttribute("data-copy"))
        );
      });
    </script>
  </body>
</html>
